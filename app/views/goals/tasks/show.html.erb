<% content_for(:title, 'タスク詳細') %>

<div class="d-sm-flex flex-sm-column flex-md-row justify-content-around mb-3">
  <div>
    <div id="task_header<%= @task.id %>">
      <%= render 'task_header', task: @task, is_tasks_path: false %>
    </div>

    <% if current_user?(@task.user) %>
      <div class="text-start">
        <button type="button" class="btn me-3" data-bs-toggle="modal" data-bs-target="#taskFormModal<%= @task.id %>">
          <i class="fa-solid fa-pen"></i>
        </button>

        <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#taskDeleteModal<%= @task.id %>">
          <i class="fa-solid fa-trash"></i>
        </button>
      </div>

      <div id="task_update_modal<%= @task.id %>">
        <%= render 'shared/task_update_modal', task: @task, is_tasks_path: false %>
      </div>
      <%= render 'shared/task_delete_modal', task: @task %>
    <% end %>
  </div>

  <div class="text-end">
    <div class="text-md-center my-4">
      <% if @task.completed_at? %>
        <p class="text-success">完了(<%= l @task.completed_at, format: :date %>)</p>
      <% elsif current_user?(@task.user) %>
        <%= link_to '終了投稿する', new_task_complete_post_path(@task), class: 'btn btn-primary' %>
      <% end %>
    </div>

    <div>
      <%= link_to @task.user, class: 'text-reset text-decoration-none ' do %>
        <%= image_tag @task.user.image, class: 'rounded-circle', alt: "#{@task.user.name}のアイコン", width: 30, height: 30 %>
        <%= @task.user.name %>さん(作成者)
      <% end %>
    </div>
  </div>
</div>

<div class="d-flex justify-content-center mb-5">
  <%= link_to '目標一覧へ戻る', goal_tasks_path(@task.goal), class: 'btn btn-secondary' %>
</div>

<% if @task.completed_at? %>
  <div class="d-sm-flex flex-sm-column flex-md-row justify-content-around mb-3">
    <h2 class="fs-4">終了投稿</h2>
  </div>
  <p class="text-center">いいねやコメントでお祝いしましょう！</p>
  <% complete_post = @task.complete_post %>
  <%= render 'shared/complete_post', complete_post: %>
<% end %>

<%= render 'shared/recent_comments', commentable: @task %>
<div class="mt-3" id="comment_form">
  <%= render 'shared/comment_form', commentable: @task %>
</div>
